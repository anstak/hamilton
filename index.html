<!DOCTYPE html>
<html>
<head>
  <title>Hamilton</title>
  <link rel="stylesheet" type="text/css" href="reset.css" />
  <link href="http://fonts.googleapis.com/css?family=Inconsolata:400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
<div class="container">
  <h1>Hamilton</h1>
  <ul id="nav">
    <li><a href="#" id="dot-open">DOT</a></li>
    <li><a href="#" id="save-canvas"><img src="img/download.png" width="40" height="30"></a></li>
  </ul>
  <canvas id="hamilton-canvas" width="860px" height="600px">
  Bro, get some HTML5 Canvas.
  </canvas>
  <canvas id="capture-canvas">
  Broseph
  </canvas>
  <div id="spotlight" style="display:none;">
    <div id="wrapper">
      <div id="stage-dot">
      <h2>Import DOT description</h2>
      <form method="post" id="hamilton-dot">
        <textarea id="dot-code"></textarea>
        <input type="button" id="dot-go" value="Go" />
        <input type="button" id="reset-layout" value="Reset" />
      </form>
      </div>
      <div id="stage-img">
      <h2>Export to image.</h2>
      <img id="canvas-img" alt="Right click to save me!">
      <h3>Right click and select save as...</h3>
      </div>
    </div>
  </div>
  <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
  <script type="text/javascript" src="lib/Dot.js"></script>

  <script type="text/javascript" src="lib/util.js"></script>
  <script type="text/javascript" src="lib/Hamilton.js"></script>
  <script type="text/javascript" src="lib/Vertex.js"></script>
  <script type="text/javascript" src="lib/Edge.js"></script>
  <script type="text/javascript" src="lib/Layout.js"></script>
  <script type="text/javascript">
  var hamilton = new Hamilton(document.getElementById('hamilton-canvas'));
  hamilton.name = "example";
  hamilton.type = "graph";
  hamilton.addVertex(new Hamilton.Vertex());
  hamilton.addVertex(2, 225, 150);
  hamilton.addVertex('derp', 200, 50);
  hamilton.addVertex(0, 150, 100);
  hamilton.addEdge(2, 'derp');
  hamilton.addEdge(0, 'derp');
  var layout = new Layout(hamilton);
  console.log(hamilton);
  layout.layout();
  layout.applyLayout();
  hamilton.draw();

  $('#dot-open').click(function() {
                          $('#dot-code').val(hamilton.toDot());
                          $('#stage-img').hide();
                          $('#stage-dot').show();
                          $('#spotlight').fadeIn(200);
  });
  $('#stage-dot').click(function(event) { event.stopPropagation(); });
  $('#spotlight').click(function() { $(this).fadeOut(200); });

  $('#save-canvas').click(function() {
                          doImageCapture(hamilton);
                          $('#stage-dot').hide();
                          $('#stage-img').show();
                          $('#spotlight').fadeIn(200);
  });
  function doImageCapture(graph) {
    var maxx = -Infinity, minx = Infinity, maxy = -Infinity, miny = Infinity;
    var canvas = document.getElementById('capture-canvas');
    var context = canvas.getContext("2d");

    for (id in graph.vertices) {
      var x = graph.vertices[id].props.x,
          y = graph.vertices[id].props.y;
      if(x > maxx) maxx = x;
      if(x < minx) minx = x;
      if(y > maxy) maxy = y;
      if(y < miny) miny = y;
    }
    graph.drawGrid = false;
    graph.draw();
    var imgData = graph.context.getImageData(minx-30, miny-30, (maxx-minx+60), (maxy-miny+60));
    graph.drawGrid = true;
    canvas.width = (maxx-minx+60);
    canvas.height = (maxy-miny+60);
    context.putImageData(imgData, 0,0);

    document.getElementById('canvas-img').src = canvas.toDataURL();
  }



  </script>
</div>
</body>
</html>
