<!DOCTYPE html>
<html>
<head>
  <title>Hamilton</title>
  <link rel="stylesheet" type="text/css" href="reset.css" />
  <style type="text/css">
  body {
    font-family: Helvetica, Arial, sans-serif;
    padding: 30px 50px;
  }
  h1 {
    font-size: 36px;
    margin-bottom: 10px;
  }
  #hamilton-canvas {
    border: 1px solid #ddd;
  }
  </style>
</head>
<body>
  <h1>Hamilton</h1>
  <canvas id="hamilton-canvas" width="600px" height="600px">
  Bro, get some HTML5 Canvas.
  </canvas>
  <script type="text/javascript">
  function copyProperties(defaults, props) {
    var key;
    for (key in props) {
      defaults[key] = props[key];
    }
  }

  function HamiltonVertex(props) {
    this.props = {
      x: 50,
      y: 50,
      r: 10,
      stroke: {
        width: 3
      }
    };
    copyProperties(this.props, props);
  }

  HamiltonVertex.prototype.draw = function(context) {
    context.save();
    context.beginPath();
    context.lineWidth = this.props.stroke.width;
    if (this._hover) {
      context.strokeStyle = 'blue';
    }
    context.arc(this.props.x, this.props.y, this.props.r, 0, 2*Math.PI);
    context.stroke();
    context.restore();
  };

  function Hamilton(canvas) {
    this.canvas = canvas;
    this.context = canvas.getContext('2d');
    this.vertices = [];
    var self = this;
    function onMouseMove() {
      self._onMouseMove.apply(self, arguments);
    }
    this.canvas.addEventListener('mousemove', onMouseMove);
    this._listener = onMouseMove;
  }

  Hamilton.Vertex = HamiltonVertex;

  Hamilton.prototype.draw = function() {
    var i;
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    for (i = 0; i < this.vertices.length; ++i) {
      this.context.save();
      this.vertices[i].__HAM__drawn = true;
      this.vertices[i].draw(this.context);
      this.context.restore();
    }
  };

  Hamilton.prototype.addVertex = function(vertex) {
    if (!vertex instanceof Hamilton.Vertex) {
      return;
    }
    this.vertices.push(vertex);
  };

  function dist(x1, y1, x2, y2) {
    return Math.sqrt((x1-x2)*(x1-x2) + (y1-y2)*(y1-y2));
  }
  function hoverVtx(v, x, y) {
    return dist(v.props.x, v.props.y, x, y) <= v.props.r;
  }

  Hamilton.prototype._onMouseMove = function(event) {
    var i, x = event.layerX, y = event.layerY;
    if (this._focusVtx) {
      if (hoverVtx(this._focusVtx, x, y)) {
        return;
      }
      this._focusVtx._hover = false;
      this._focusVtx.draw(event.target.getContext('2d'));
      document.body.style.cursor = 'default';
      this._focusVtx = null;
    }
    // Iterate from back to front ~ top to bottom stack rendering order
    for (i = this.vertices.length - 1; i >= 0; --i) {
      var v = this.vertices[i];
      if (hoverVtx(v, x, y)) {
        v._hover = true;
        v.draw(event.target.getContext('2d'));
        document.body.style.cursor = 'pointer';
        this._focusVtx = v;
        break;
      }
    }
  };

  var hamilton = new Hamilton(document.getElementById('hamilton-canvas'));
  hamilton.addVertex(new Hamilton.Vertex());
  hamilton.draw();
  </script>
</body>
</html>
